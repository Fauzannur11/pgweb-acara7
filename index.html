<!DOCTYPE html>
<html>

<head>
    <title>Latihan7</title>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <style>
        #map {
            width: 100%;
            height: 90%;
        }

        #map:focus {
            outline: #4A74A8 solid 0.15em;
        }
    </style>
</head>

<body>
    <div id="map" class="map"></div>
    <div id="container">
        <button id="trackButton">Get My Location</button>
    </div>
    <div id="popup" title="Lokasi GPS">
        <p>Latitude: <span id="popupLatitude"></span></p>
        <p>Longitude: <span id="popupLongitude"></span></p>
    </div>
    <button id="zoom-out">Zoom out</button>
    <button id="zoom-in">Zoom in</button>
    <script>
        var map = new ol.Map({
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                })
            ],
            target: 'map',
            view: new ol.View({
                center: ol.proj.transform([110.36666105754671, -7.76464403814382], 'EPSG:4326', 'EPSG:3857'),
                zoom: 9
            })
        });

        var dialog = $("#popup").dialog({
            autoOpen: false,
            modal: true,
        });

        document.getElementById('zoom-out').onclick = function () {
            var view = map.getView();
            var zoom = view.getZoom();
            view.setZoom(zoom - 1);
        };
        document.getElementById('zoom-in').onclick = function () {
            var view = map.getView();
            var zoom = view.getZoom();
            view.setZoom(zoom + 1);
        };

        // Fungsi untuk melacak lokasi GPS
        function trackLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var latitude = position.coords.latitude;
                    var longitude = position.coords.longitude;

                    // Membuat titik pada lokasi GPS
                    var point = new ol.geom.Point(ol.proj.transform([longitude, latitude], 'EPSG:4326', 'EPSG:3857'));
                    var feature = new ol.Feature({
                        geometry: point
                    });

                    // Membuat lapisan vektor dan menambahkan fitur
                    var vectorLayer = new ol.layer.Vector({
                        source: new ol.source.Vector({
                            features: [feature]
                        })
                    });

                    // Menampilkan kotak dialog ketika fitur pada peta diklik
                    map.addLayer(vectorLayer);
                    map.on('click', function (evt) {
                        map.forEachFeatureAtPixel(evt.pixel, function (feature) {
                            var coordinates = feature.getGeometry().getCoordinates();
                            var lonLat = ol.proj.transform(coordinates, 'EPSG:3857', 'EPSG:4326');
                            document.getElementById("popupLatitude").textContent = lonLat[1];
                            document.getElementById("popupLongitude").textContent = lonLat[0];
                            dialog.dialog("open");
                        });
                    });
                }, function (error) {
                    console.error("Error getting location: " + error.message);
                });
            } else {
                alert("Geolocation is not supported by your browser.");
            }
        }

        // Menambahkan event listener untuk tombol
        var trackButton = document.getElementById("trackButton");
        trackButton.addEventListener("click", trackLocation);
    </script>
</body>

</html>
